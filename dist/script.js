"use strict";(()=>{async function w(){return console.log("gameLayout called"),new Promise(o=>{let d=document.querySelector("body"),e=document.createElement("h1");e.style.fontFamily="Pixelify Sans, Rubik Broken Fax",e.textContent="BattleShip",e.classList.add("text-5xl","font-extrabold","text-center","mb-10","mt-10"),d?.appendChild(e);let a=document.createElement("div");a.setAttribute("id","gameLayout"),a.classList.add("flex","w-full","h-full","gap-10","p-10"),d?.appendChild(a);let l=document.createElement("div");l.setAttribute("id","playerBoard"),l.classList.add("grid","column-gap-0","border-2","border-black","mx-auto","my-auto"),x(l),a.appendChild(l);let n=document.createElement("div");n.setAttribute("id","computerBoard"),n.classList.add("grid","column-gap-0","border-2","border-black","mx-auto","my-auto"),x(n),a.appendChild(n),o()})}function x(o){for(let d=0;d<10;d++){for(let e=0;e<10;e++){let a=document.createElement("div");a.classList.add("w-10","h-10","border-2","border-black"),a.setAttribute("row",`${d}`),a.setAttribute("col",`${e}`),a.setAttribute("id","square"),a.innerHTML="",o.appendChild(a)}o.style.gridTemplateColumns="repeat(10, [col-start] 1fr [col-end])"}}async function L(){return console.log("startGame called"),new Promise(o=>{let d=document.querySelector("body"),e=document.createElement("modal");e.setAttribute("id","modal");let a=document.createElement("div");a.classList.add("fixed","left-0","top-0","flex","h-full","w-full","items-center","justify-center","bg-black","bg-opacity-50","py-10"),e.appendChild(a);let l=document.createElement("div");l.classList.add("max-h-full","w-full","max-w-xl","overflow-y-auto","sm:rounded-2xl","bg-white"),a.appendChild(l);let n=document.createElement("div");n.classList.add("w-full"),l.appendChild(n);let r=document.createElement("div");r.classList.add("m-8","my-20","max-w-[400px]","mx-auto"),n.appendChild(r);let t=document.createElement("div");t.classList.add("mb-8","text-center"),r.appendChild(t);let s=document.createElement("h1");s.classList.add("mb-4","text-3xl","font-extrabold"),s.textContent="BattleShip Game",t.appendChild(s);let m=document.createElement("p");m.classList.add("text-gray-600"),m.textContent="Embark on an epic naval adventure, a thrilling Battleship game that pits you against an intelligent opponent in a strategic battle for naval supremacy.",t.appendChild(m);let c=document.createElement("div");c.classList.add("space-y-4"),r.appendChild(c);let i=document.createElement("button");i.classList.add("p-3","bg-black","rounded-full","text-white","w-full","font-semibold"),i.textContent="Start Game",i.setAttribute("id","startButton"),i.addEventListener("click",()=>{e.remove(),o(),console.log("startGame ended")}),c.appendChild(i),d?.appendChild(e)})}async function v(){return console.log("readyToStart called"),new Promise(o=>{let d=document.querySelector("body"),e=document.createElement("modal");e.setAttribute("id","modal");let a=document.createElement("div");a.classList.add("fixed","left-0","top-0","flex","h-full","w-full","items-center","justify-center","bg-black","bg-opacity-50","py-10"),e.appendChild(a);let l=document.createElement("div");l.classList.add("max-h-full","w-full","max-w-xl","overflow-y-auto","sm:rounded-2xl","bg-white"),a.appendChild(l);let n=document.createElement("div");n.classList.add("w-full"),l.appendChild(n);let r=document.createElement("div");r.classList.add("m-8","my-20","max-w-[400px]","mx-auto"),n.appendChild(r);let t=document.createElement("div");t.classList.add("mb-8","text-center"),r.appendChild(t);let s=document.createElement("h1");s.classList.add("mb-4","text-3xl","font-extrabold"),s.textContent="Ready to play?",t.appendChild(s);let m=document.createElement("p");m.classList.add("text-gray-600"),t.appendChild(m);let c=document.createElement("div");c.classList.add("space-y-4"),r.appendChild(c);let i=document.createElement("button");i.classList.add("p-3","bg-black","rounded-full","text-white","w-full","font-semibold"),i.textContent="Start",i.setAttribute("id","startButton"),i.addEventListener("click",()=>{e.remove(),o()}),c.appendChild(i),d?.appendChild(e)})}var f=()=>{let o=Array.from({length:10},()=>Array(10).fill("")),d=[],e=[],a=(t,s,m,c)=>{if(n(t,s,m,c)){let i=[];for(let u=0;u<t.length;u++){let p=c?s+u:s,b=c?m:m+u;o[p][b]="#",i.push({row:p,col:b})}t.coordinates=i,d.push(t)}else console.log("Invalid ship placement");console.log(d)},l=(t,s)=>{if(o[t][s]==="#"){let c=d.find(i=>i.coordinates.some(u=>u.row===t&&u.col===s));c&&c.hit()}else e.push({row:t,col:s}),console.log("Missed the target!")},n=(t,s,m,c)=>{let i=c?s+t.length-1:s,u=c?m:m+t.length-1;if(i>=10||u>=10)return!1;for(let p=s;p<=i;p++)for(let b=m;b<=u;b++)if(o[p][b]==="#")return!1;return!0};return{placeShip:a,receiveAttack:l,areAllShipsSunk:()=>{let t=0;return d.forEach(s=>{s.isSunk===!0&&(console.log("Not all ships are sunk"),t++)}),console.log(d),t===1?(console.log("All ships are sunk"),!0):!1},grid:o,ships:d,missedAttacks:e}};var S=o=>({attack(d,e){o.receiveAttack(d,e)}}),E=o=>{let d=[],e,a=A(),l=[];if(a.length>0){let n=Math.floor(Math.random()*a.length),{row:r,col:t}=a[n];d.push({row:r,col:t}),e={row:r,col:t}}else console.log("No available coordinates");return{attack(){o.receiveAttack(e.row,e.col),l.push(e.row,e.col)},array:l}};function A(){let o=[];for(let d=0;d<10;d++)for(let e=0;e<10;e++)o.some(l=>l.row===d&&l.col===e)||o.push({row:d,col:e});return o}var y=o=>({length:o,coordinates:[],hits:0,isSunk:!1,hit(){this.hits+=1,this.hits===this.length?(this.isSunk=!0,console.log("Ship is sunck")):console.log("Ship hit")}});var g=async(o,d,e)=>o?.id==="computerBoard"?new Promise(a=>{let l=n=>{let r=n.target.getAttribute("row"),t=n.target.getAttribute("col");d.attack(r,t),n.target.classList.contains("bg-green-500")?(n.target.classList.remove("bg-green-500"),n.target.classList.add("bg-red-500")):n.target.classList.add("bg-gray-500"),o?.removeEventListener("click",l),a()};o?.addEventListener("click",l)}):new Promise(a=>{e.attack(),o?.querySelector(`[row="${e.array[0]}"][col="${e.array[1]}"]`)?.classList.contains("bg-green-500")?(o?.querySelector(`[row="${e.array[0]}"][col="${e.array[1]}"]`)?.classList.remove("bg-green-500"),o?.querySelector(`[row="${e.array[0]}"][col="${e.array[1]}"]`)?.classList.add("bg-red-500")):o?.querySelector(`[row="${e.array[0]}"][col="${e.array[1]}"]`)?.classList.add("bg-gray-500"),a()}),k=()=>{let o=0;return new Promise(d=>{let e=document.getElementById("playerBoard"),a=[],l,n,r=!1,t=0,s=m=>{if(o===0)l=m.target;else if(o===1){if(n=m.target,l.getAttribute("row")===n.getAttribute("row")){t=Math.abs(Number(l.getAttribute("col"))-Number(n.getAttribute("col"))),r=!1;let c=Number(l.getAttribute("row")),i=Number(l.getAttribute("col"));a.push(t+1,r,c,i)}else if(l.getAttribute("col")===n.getAttribute("col")){t=Math.abs(Number(l.getAttribute("row"))-Number(n.getAttribute("row"))),r=!0;let c=Number(l.getAttribute("row")),i=Number(l.getAttribute("col"));a.push(t+1,r,c,i)}}o++,o===2&&(e?.removeEventListener("click",s),d(a))};e?.addEventListener("click",s)})},h=()=>Math.floor(Math.random()*9)+1,C=(o,d,e,a,l)=>{for(let n=0;n<d.length;n++){let r=l?e+n:e,t=l?a:a+n;o?.querySelector(`[row="${r}"][col="${t}"]`)?.classList.add("bg-green-500")}};document.addEventListener("DOMContentLoaded",async()=>{await L().then(()=>{w().then(()=>{console.log("gameLayout ended"),setTimeout(()=>alert("Let's place your ships, first ship is one square long!"),1e3)})});let o=document.getElementById("playerBoard"),d=document.getElementById("computerBoard"),e=f(),a=f(),l=S(a),n=E(e);for(let r=1;r<2;r++){let t=await k();if(t[0]!=r)alert("Invalid ship length, please try again"),r--;else{r>=1&&r<5&&alert("Place the next ship of "+(r+1)+" square length!");let s=y(r);e.placeShip(s,t[2],t[3],t[1]),C(o,s,t[2],t[3],t[1])}}for(let r=1;r<2;r++){let t=[],s=h(),m=h(),c=!1,i=[s,m];t.forEach(p=>{p===i&&(s=h(),m=h(),i=[s,m],t.push(i))}),i[0]>6?c=!1:(i[1]>6||Math.floor(Math.random()*2)===0&&(c=!1),c=!0);let u=y(r);a.placeShip(u,i[0],i[1],c),C(d,u,i[0],i[1],c)}await v().then(async()=>{console.log("readyToStart ended");let r=!1;for(alert("Choose your target!");!r;)await g(d,l,n).then(async()=>{a.areAllShipsSunk()===!0&&(alert("You win!"),r=!0),await g(o,l,n).then(()=>{e.areAllShipsSunk()===!0&&(alert("Computer win!"),r=!0)})})})});})();
